---
title: All the RAGE with Couchbase Server 
author: Eric Bishard 
date: 2019-11-226
hero: ./images/hero.jpg
excerpt: Let's build a full stack JS app with React, Apollo, GraphQL and Express using Couchbase Server as a datastore.
secret: true
slug: couchbase-graphql
---

## What Exactly Are We Building?

My last article on creating a [GraphQL server in Express](/getting-started-with-graphql-node-and-express/) keeps it simple, uses in memory-data and teaches the basics of using GraphQL in Express. 
I wanted to take that code further and add a datastore and frontend application with [React JS](https://reactjs.org/) with [React Apollo](https://www.apollographql.com/docs/react/api/react-apollo/).

What I'm most excited about in this tutorial is GraphQL and teaching how easy it is to work with both React and Express, and if you have not worked with GraphQL before, this is a great way to get started. 
As a high-level overview, GraphQL is a query language for your API, it provides granular control over data allowing developers to be flexible without unnecessary calls to the server. 
It's a declarative way of fetching data and developers love it because it provides an alternative to working with REST apis, as well it can aid in simply working with REST apis and has a strongly typed schema. 
Too much to talk about in an intorduction, just know that it's just very versatile and in my opinion, there is zero reasons not to learn GraphQL as a JavaScript developer.

We also need a datastore, so I also wanted to introduce you to a NoSQL solution for data storage which will sit behind the server app and since NoSQL document data solutions store our JSON data jsut as we have it, we don't have to do any parsing and serialization.

We will use [Couchbase Server](https://docs.couchbase.com/server/6.0/sdk/overview.html) as our document store. 
We will just scratch the surface of what it can do but again the intent is to get you setup with these various technologies and future blogs will go more in depth into NoSQL, document datastores, React, Express, GraphQL, let's just get introduced to the stack today! 

The [Couchbase Server NodeJS SDK](https://docs.couchbase.com/nodejs-sdk/current/start-using-sdk.html) will give us the tools we need in order to connect via [Node](https://nodejs.org/) and [Express](https://expressjs.com/) to our [bucket](https://docs.couchbase.com/server/current/learn/buckets-memory-and-storage/buckets.html) (database) in Cocuhbase Server.
No matter what language you work with, we strive to help you here at Couchbase allowing you to easily deploy on bare metal, your local dev machine, AWS, Azure, Digital Ocean, GCP or of course, containerized with Docker. It's a multidimensional service, meaning you can choose which services run what nodes. Supporting is available through SDKs in the most popular languages: [C](https://docs.couchbase.com/c-sdk/2.10/start-using-sdk.html), [.NET](https://docs.couchbase.com/dotnet-sdk/2.7/start-using-sdk.html), [Go](https://docs.couchbase.com/go-sdk/1.6/start-using-sdk.html), [Java](https://docs.couchbase.com/java-sdk/2.7/start-using-sdk.html), [NodeJS](https://docs.couchbase.com/nodejs-sdk/2.6/start-using-sdk.html), [PHP](https://docs.couchbase.com/php-sdk/2.6/start-using-sdk.html), [Python](https://docs.couchbase.com/python-sdk/2.5/start-using-sdk.html) and [Scala](https://docs.couchbase.com/scala-sdk/1.0/start-using-sdk.html). 
Another great thing about Couchbase Server is that it builds off of your SQL skills and makes those completely transferable to a NoSQL solution using [N1QL (SQL for JSON) Database Query Language](https://www.couchbase.com/products/n1ql).
Just understand that Couchbase Server could scale with your project unlike any other solution out there. If you need more information, reach out to me on Twitter [@httpJunkie](https://twitter.com/httpJunkie). 

Let's install Couchbase locally and then we will use Express and GraphQL to build a simple API endpoint that we can retrieve airline information, after that, we will build a React application that uses [Apollo Client](https://github.com/apollographql/apollo-client) to connect to our GraphQL server. 

## Installing Couchbase Server

The installation process is straight forward and we have you covered on [Linux](https://docs.couchbase.com/server/4.0/install/install-linux.html), [Mac](https://docs.couchbase.com/server/4.0/install/macos-install.html), [Windows](https://docs.couchbase.com/server/4.0/install/install-package-windows.html). I'll walk you through it all!

I have followed the instructions for both Windows and Mac as they both have a few more steps than Linux which is the easiest. I just wanted to ensure there are no major hangups or gotchas I might need to explain and I had zero issues on both, but as always, reach out to me on Twitter [@httpJunkie](https://twitter.com/httpJunkie) with any questions if needed.

## Logging into Your Local Couchbase Server Console

Once installed, on all platforms, you can access the Web Console by connecting to the webserver on [localhost:8091](http://localhost:8091). From this screen, you can click "[Setup New Cluster](https://docs.couchbase.com/server/6.0/install/init-setup.html)".

Make the cluster name something simple and setup the admin user and password, this account is a full admin with read-write access to all of your Couchbase Server resources, FYI it's not what you will use to connect to your database/bucket from our Express client that will be a user that we set up separately. 
I Configured my cluster with the default service memory quotas. Save and Finish!

Let's access the Dashboard once logged in and click on "Servers" to see our initially created server.

Next click on "Buckets". A Couchbase Bucket is a document database. The data is stored persistently, as well as in memory. This allows data to be automatically replicated for availability and uses the [Database Change Protocol (DCP)](https://developer.couchbase.com/documentation/server/3.x/admin/Concepts/dcp.html).

Next, click on "Add Bucket" and we want to create a "Sample Bucket". We want to select `travel-sample` for our demo. 

Using their sample database will allow us to get right to querying our data from within Express, but without all the fuss of setting up indexes. Indexes are set up automatically in this travel-sample bucket saving us some time. If you want to learn more and create your own bucket and indexes, [check out this article](https://blog.couchbase.com/create-right-index-get-right-performance/)!

You will now see our Bucket, just like in the image below:

![travel-sample bucket](/images/travel-sample-bucket.jpg)

If we click on the "Documents" button we can see some of the data in our Bucket:

![travel-sample document](/images/travel-sample-document.jpg)

And further, we can click the "Edit Document as JSON" icon of a document to see the JSON for that specific key's value and even edit the data if you like.

![travel-sample edit document](/images/travel-sample-edit-document.jpg)

Before moving on, we want to click on the "Security" tab and set up a user to connect to this bucket.

Once we are on the "Security" page, let's click on "Create User" in the upper right. We need to add a username and password specific for connecting to the bucket. In the image, I use my own name and it will match the info in the source code for the project. So remember that if you use your own name the code you copy below will need to be updated.

![travel-sample add user](/images/travel-sample-user.jpg)

Make sure to check the "Application Access" checkbox for our `travel-sample` bucket. That's all we need. Remember your username and password, as we will need this to connect.

## Bucket Indexes

For this demo, we are not going to add or get into indexes, I wanted to choose the sample database because it comes setup with indexes. If we had not done this, we would have had to set the indexes up on our own, and if not, we would run into issues querying our data.

If you want to learn more about setting up indexes, you can find more information in this [Coucbase blog article](https://blog.couchbase.com/create-right-index-get-right-performance/) and in the [couchbase documentation](https://docs.couchbase.com/server/6.0/learn/services-and-indexes/indexes/global-secondary-indexes.html). Below is an image of the indexes that are set up with our `travel-sample` bucket.

![travel-sample add user](/images/travel-sample-indexes.jpg)

## A Quick Mention about N1QL Queries

As we are not fully covering everything in this demo so I wanted to mention the type of querying we will use. Couchbase Server gives you the ability to use N1QL queries which is a way to query our buckets using a SQL-like syntax. We will use a combination of that and an API provided by the `couchbase` npm package to do our querying. 

You can find more information on [N1QL](https://docs.couchbase.com/server/current/n1ql/n1ql-language-reference/index.html) in the documentation as well as information about using the  `couchbase.get` method of querying from the documentation for the [Couchbase Server NodeJS SDK](https://docs.couchbase.com/nodejs-sdk/current/core-operations.html#crud-overview).

## Creating Our Node, Express-GraphQL API

I assume a few things in this next part of the tutorial

- You have node and npm installed
- You understand basic JavaScript
- You have read up on the basics of GraphQL

The last item is important, you should not only know where the basic documentation for GraphQL is, but you should have skimmed through the following three pages:

- [Introduction](https://graphql.org/learn/)
- [Queries and Mutations](https://graphql.org/learn/queries/)
- [Schemas and Types](https://graphql.org/learn/schema/)

If you have not skimmed through these pages, you should do so before moving forward or use them for reference if you don't understand something.

### Create Our Overall Project Directory and Ignore File

We need to create a directory on your machine to house our entire project, we will call it `rage-with-couchbase`:

```bash
mkdir rage-with-couchbase && cd $_
```

`mkdir` will create a new folder using the string `rage-with-couchbase` for the name and bash stores that string in a variable we can use named `$_`.

we change directories using `$_` to ensure we don't misspell the same directory we already typed (it's bash magic).

Next, we create a file named `.gitignore` in the root of our overall project.

```
touch .gitignore && echo "node_modules/" >> .gitignore
```

`touch` will generate a `.gitignore` file.

`echo` and `>>` will append `node_modules/` at the end of `.gitignore`, ignoring all **node_modules** to folders and all subfolders.

### Creating Our Express Server

Now we will create the directory to store our Express server and we will use npm to manage its packages.

```bash
mkdir couchbase-gql-server && cd $_ && npm init -y
```

`mkdir` will create a new folder inside the project root specifically for our server using the string `couchbase-gql-server` for the name, this is your server project directory.

we change directories and use the `$_` (more magic) and then we initialize an **npm** project using `npm init -y` accepting the default values with the `-y` flag.

### Install Our Server Dependencies

```bash
npm install graphql express express-graphql couchbase uuid
```

This will take some time, but once it's done running, we should now have Visual Studio Code open and our project is ready for us to start working in!

### Add Server and Set up Our Require Statements

Change directories into your `couchbase-gql-server` Create a file named `server.js` in the root of the project and add the following code to the file:

```JS
const express = require('express')
const graphqlHTTP = require('express-graphql')
const { buildSchema } = require('graphql')

const couchbase = require('couchbase')
const uuid = require('uuid')
```

This will bring in everything we need to get our GraphQL server setup. 

The first three are needed for setting up Express and GraphQL and the last two are required for querying and logging into our Couchbase Server.

### Initialize Express and Connect to Our Bucket

After adding the code above, we need to create an Express app and connect to our Couchbase Server bucket. Add the following code:

```JS
const app = express()
const cluster  = new couchbase.Cluster("couchbase://localhost:8091/")
      cluster.authenticate("ebishard", "123456")
      
const bucket = cluster.openBucket("travel-sample")
```

Everything above should look familiar, we are simply creating a connection to our Couchbase Server cluster, authenticating with our user that we set up and opening our `travel-sample` bucket.

### Create Our GraphQL Schema

Next, we will add more code again and this will define the endpoints that we will use in our GraphQL Server that corresponds with documents inside of our Couchbase Server bucket. Add the following code:

```JS
const schema = buildSchema(`
  type Query {
    airlinesUK: [Airline],
    airlineByKey(id: Int!): Airline
  }
  type Airline {
    id: Int,
    callsign: String,
    country: String,
    iata: String,
    icao: String,
    name: String
  }
`)
```

In GraphQL we have the concept of a `Query`, to show you how we can query the data in a few different ways we will fetch a list of `Airlines` in an endpoint named `airlinesUK` and we will have another endpoint that is responsible for fetching a single `Airline` by ID using the Buckets Key-value, that endpoint will be called `airlineByKey` and it will take an `Airline` ID.

If you remember from our Bucket images above, each document is defined by a key in the format of `airline_1234` where `1234` is the ID of the airline.

![travel-sample document](/images/travel-sample-document.jpg)

We will keep this id in mind when using the NodeJS SDK to fetch our individual `airlineByKey` using a simple `bucket.get()` method.

### Create Our Resolver Implementation for Each Endpoint

Now, that we have defined the two types of queries that we will expose in our GraphQL API by way of our `schema` object, we need to provide an implementation in JavaSCript for retrieving the data fro each one from our Couchbase bucket. 

Add the following code to our `server.js` file:

```JS
const root = {
  airlinesUK: () => {
    let statement = 
      "SELECT META(airline).id, airline.* " +
      "FROM `travel-sample` AS airline " +
      "WHERE airline.type = 'airline' " +
      "AND airline.country = 'United Kingdom' "
    let query = couchbase.N1qlQuery.fromString(statement);
    return new Promise((resolve, reject) => 
      bucket.query(
        query, (error, result) => error ? reject(error) : resolve(result)
      )
    )
  },
  airlineByKey: (data) => {
    let dbkey = "airline_" + data.id
    return new Promise((resolve, reject) =>
      bucket.get(
        dbkey, (error, result) => error ? reject(error) : resolve(result.value)
      )
    )
  }
}
```

So in the example code above, we are using two different methods to query our Couchbase Server. 

The first method used by the `airlinesUK` resolver uses the `bucket.query` method and in turn that takes in an N1QL or standard SQL query. This is great because if you are familiar with SQL which most of us are, it makes the barrier to entry a lot less steep when working with document databases in Couchbase Server.

The second method used is the `bucket.get` method and in this case we are just defining the key of our document for easy retrieval from our bucket. Remember that one of the great things about using a key-value data store to store our documents is that we can easily pick out a single document in this way.

Each of the methods above also tests for query errors and either resolve or reject based on success or error.

**__NOTE: I have broken up my N1QL (SQL for JSON) query into separate lines and at the end of each line there is a space before the closing quote. Without those, you will generate an error.__**

### Creating Our Express-GraphQL Server

Now that we have everything sorted out for our endpoints and queries, all we need to do is `use` our Express server and give it a port to run on, let's do that now. 

Add the following code to the end of our `server.js` file:

```JS
const serverPort = 4000
const serverUrl = '/graphql'
app.use(serverUrl, graphqlHTTP({
  schema: schema,
  rootValue: root,
  graphiql: true
}))

app.listen(serverPort, () => {
  let message = `GraphQL server now running on http://localhost:${serverPort}${serverUrl}`
  console.log(message)
})
```

If you have ever created an Express or Express-GraphQL server, this code should look familiar. 

We set up our port and GraphQL URL I like creating them is separate variables for ease of use.

Next, we pass in our GraphQL schema and it's resolvers and set our `graphiql` option to true. This will give us an IDE to test our GraphQL queries in and it will be available at the address: [localhost](http://localhost:4000/graphql)

Finally, we listen on port 4000 and set a message in the console to indicate our server is running. 

Let's test this out by running:

```bash
node server
```

Once we have the GraphQL server running we can test the `AirlinesUK` query by simply pasting the following code into the GraphQL IDE query pane:

```graphiQL
query getAirlinesUK{
  airlinesUK {
    id
    name
    callsign
    country
    iata
    icao
  }
}
```

As the query indicates it will retrieve all of our UK based airlines:

![travel-sample add user](/images/travel-sample-graphiql-airlinesUK.jpg)

Next, we will use the `airlineByKey` endpoint, in this example, we will also need to create a query variable and paste it into the respective pane:

```graphiQL
query getAirlineByKey($id: Int!) {
  airlineByKey(id:$id){
    id
    name
    callsign
    country
    iata
    icao
  }
}
```

```graphiQL
{
  "id": 112
}
```

And with that in place and we can query again and retrieve a single airline document by key:

![travel-sample add user](/images/travel-sample-graphiql-airlineByKey.jpg)

This concludes the section for our GraphQL Server, we are now ready to create our React application that will use these endpoints to create a very small application with a master-detail page that will get all UK airlines and show them in a list and when we click on one, in particular, it will show the full details of the airline.

## Creating the React Application

The intent of this tutorial is not to teach how to build the entire React portion of the application step by step, but I want you to be able to walk away with a working React app with routing, a menu, etc..

For this reason, we are going to clone an existing project into our project, it will have all of the basic setup created already with Create React App. It will have basic routing and existing components ready to hook up. What we will focus on instead is specifically the portion that deals with fetching the data from GraphQL and setting up the Apollo client using React Apollo.

### Clone an Existing React Application

Our decoupled React frontend will be a sibling to the server directory. Our goal is to have the following directory structure:

```
rage-with-couchbase
│   
└───couchbase-gql-server
│   
└───react-apollo-client
```

Let's run the following git command from the `rage-with-couchbase` directory in our terminal in order to clone the starting point for our React project:

```bash
git clone https://github.com/httpJunkie/react-apollo-client.git && cd react-apollo-client && rm -rf .git
```

This will clone the existing repo and then remove its association with my GitHub account, it's similar to just cutting and pasting in a bunch of files into our project.

Once this is done we will have a working React application with some basic routing, as well there are some components and utilities that we will hook up and will be ready for us to use.

Let's run the project real quick just to make sure everything is working:

```bash
npm install && npm start
```

We should be able to navigate the few routes in our menu and have zero issues in the console. We are just checking to make sure we have a working app to start building on.

Before we make changes to the React client, let's understand some of the files that we have in our project that are not hooked up yet to our Airline route.

### Overview of Our Assets

We have 6 files that are not used once we clone the React app and run it for the first time, but they are there and standing by for us.

 - [hoc/withApolloProvider.js](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/hoc/withApolloProvider.js)
 - [partial/airline-list.jsx](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/partial/airline-list.jsx)
 - [partial/airline-details.jsx](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/partial/airline-details.jsx)
 - [utility/pagination.jsx](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/utility/pagination.jsx)
 - [utility/pagination.scss](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/utility/pagination.scss)
 - [routes/airline-gql.js](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/routes/airline-gql.js)

**withApolloProvider** - I am using a higher order component that I created so that I can wrap any component with a diferent GraphQL provider and endpoint if needed. Just understand that this is similar to importing the ApolloProvider in the parent component. This may or may not help you, I have used it in many projects and continue to use it just in case I need the exact same fnctionality. I also feel like it cleans things up and is easier mental model for me. Below is the `withApolloProvider` code:

```JSX
import React from 'react'
import ApolloClient from 'apollo-boost'
import { ApolloProvider } from '@apollo/react-hooks'

const withApolloProvider = (WrappedComponent, graphqlEndpoint) => {
  const apolloClient = new ApolloClient({
    uri: graphqlEndpoint,
  })

  return (props) => (
    <ApolloProvider client={apolloClient}>
      <WrappedComponent {...props} wrappedBy={"withApolloProvider"} />
    </ApolloProvider>
  )
}

export default withApolloProvider
```
We have a `airline-list.jsx` and a `airline-details.jsx` these two components will get loaded side by side in our `airlines.jsx` component. The list will simply display each airline and uses `pagination.jsx` to ensure we don't have a super long list running down the side of our page.

Finally, we have the `airline-gql.js` file which is simply our GraphQL query for all UK Airlines. I like to separate my queries out into another file for organizational purposes, it's not required, but it cleans up the `airlines.jsx` file.

### How Our Master-Detail Page Works

In our project we have a master-detail component relationship, when we are at the route for `/airlines`, we display a component called `airlines.jsx`, 
it uses React Router and when no specific `arlineId` is present in the URL like the path below:

`http://localhost:3000/airlines`

It will display a list of the airline on the left side and "Select an airline" on the right side of the page. 
Selecting an airline from the menu will load details on the right side of the page. It's pretty simple, we will use the capabilities of React Router to pass the Airline name from the path we load when a menu item is clicked:

`http://localhost:3000/airlines/1355`

Here we will match the ID `1355` with the correct airline already in memory in our React application data and display its appropriate Airline information "British Airways".

### Adding Dependencies to Work with Graphql and Apollo

To work with our GraphQL we will be using three packages: `@apollo/react-hooks`, `apollo-boost`, and `graphql`, you can bring them all into your project now because they are not included yet, `cd` into your `react-apollo-client` directory and run the install for the packages we need for GraphQL and Apollo: 

```
npm install @apollo/react-hooks apollo-boost graphql
```

For more information on working with Apollo and GraphQL you can check out the many resources on [https://www.apollographql.com](https://www.apollographql.com/docs/react/data/queries/), this link is a perfect place to start if you want to get acclimated with [making queries](https://www.apollographql.com/docs/react/data/queries/#executing-a-query) using Apollo.

### Building The Master-Detail Page

With those files explained, we can get started building the Airlines master-detail page and our first thing will be to bring in some imprts that we will need:

```JavaScript
import { useQuery } from '@apollo/react-hooks'
import { airlineGql } from './airline-gql'
```

We do our queries from Apollo with a Hook named `useQuery`. When we use it we need to pass it a GraphQL query string and that is exactly what the next import is all about.

Inside the `airline-gql.js` file is and could be all queries needed pertaining to this GraphQL endpoint, we only have one, but by organizing in this fashion we are thinking about organization and boundaries in our application:

```JavaScript
import { gql } from 'apollo-boost'

export const airlineGql = gql`
  {
    airlinesUK {
      callsign
      country
      iata
      icao
      id
      name
    }
  }
`
```

Next, we import `withApolloProvider`, a higher order component.

```JavaScript
import withApolloProvider from '../hoc/withApolloProvider'
```

This will wrap our component with and Apollo Provider, give us the ability to use multiple endpoints in our project if needed (we only will use one, sorry for overengineering). 
With that in place we need to update the export of my `airlines.jsx` file also:

```JavaScript
const WrappedComponent = withApolloProvider(Airlines, 'http://localhost:4000/graphql')
export default WrappedComponent
```

Our first argument to the HOC is the component that we are wrapping with the provider `Airlines` (already defined in this file) and the GraphQL endpoint as a second argument.

Our final imports are the two components that I have already built for you ([airline-list.jsx](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/partial/airline-list.jsx) and [airline-details.jsx](https://github.com/httpJunkie/react-apollo-client/blob/master/src/components/partial/airline-details.jsx)):

```JavaScript
import AirlineList from '../partial/airline-list'
import AirlineDetails from '../partial/airline-details'
```

Once those two files are imported we can add their component syntax to our flexbox grid ([simple-flexbox](https://www.npmjs.com/package/simple-flexbox) that we have created helping us to easily split our page by a percentage:

```JavaScript
<Row horizontal="spaced">
  <Column flexGrow={1} style={{ minWidth: '280px', width: '65%' }}>
    <AirlineList airlines={airlines} />
  </Column>
  <Column flexGrow={1} style={{ width: '45%' }}>
    <AirlineDetails airline={airline} />
  </Column>
</Row>
```

With all of this in place, we just need to deal with our data and `useQuery` returns an object from the Apollo Client with `loading`, `error`, and `data` properties we can use. We also need to match on our route path, we have access to that with React Router on the page (`match.params`).

This next bit of code is going to replace the curent definition of our functional component and insert some code just before the return statement in our `Airlines` functional definition:

```JavaScript
const Airlines = ({ match }) => {
  const airlineId = Number(match.params.id) //1
  const { loading, error, data } = useQuery(airlineGql) //2

  if (loading) return <p>Loading...</p> //3
  if (error) return <p>Error :( <span style={{color: 'red'}}>{error.message}</span> )</p> //4

  const airlines = data.airlinesUK //5
  const airline = match.params.id ? airlines.find(a => a.id === airlineId) : null //6

  return (
```

1. Here we are setting `airlineId` if the `match.params.id` returns a number and not `undefined` (do we have an ID in our route path `/airlines/1355` or not `/airlines/`?).
2. Next we are using the GraphQL query string exported in our `airlineGql` file. Remember that it returns stuff, so we are destructuring those here as well.
3. We return "loading" until the data has finished loading
4. or "Error" in the case our GraphQL server is not running or has an error, etc...
5. We capture the data for all of the airlines returned from our query into a local variable named `airlines`
6. If `match.params.id` contains a number it means our route contains an ID, in this case we capture the data for that specific airline into a local variable named `airline` otherwise we store a null value in that variable.

The `match` will work because of the way we set up our route in the `App.js` page:

```JSX
<Route exact path={["/airlines/:id", "/airlines/"]}
  render={(props) => <Airlines {...props} />}
/>
```

This route in effect says: Look for a route with the name `/airlines/` and anything after it will be available using the `match.params.id` syntax.

If we run our project right now and our GraphQL Server is not running, we get an error that says: "Error :( Network error: Failed to fetch )" printed out on our page. So we need to go and start that server before we run our React application to test out our master-detail page.

### Running Our Full Stack application

At this point, we just need to ensure our Couchbase Server instance is up and running, and from the root of our project start our Express server (in turn running our GraphQL server) running `node couchbase-gql-server/server`, then run our React project using `cd react-apollo-client/ && npm start`!

If you run into an error because of CORS, we need to add a few to your Express project's `server.js` file, just update with the following:

```JavaScript
const express = require('express')
const cors = require('cors')
const graphqlHTTP = require('express-graphql')
const { buildSchema } = require('graphql')

const couchbase = require('couchbase')
const uuid = require('uuid')

const app = express()
app.use(cors())
```

And we will need to `npm install cors`. That package is on GitHub at [github.com/expressjs/cors](https://github.com/expressjs/cors) and more information can be found on this topic in an article titled: "[How to enable CORS for Express-GraphQL & Apollo Server](https://www.prisma.io/blog/enabling-cors-for-express-graphql-apollo-server-1ef999bfb38d)"

Once that is in place, restart your Express server and React application and viola!

## Running Both Server and Client using Postinstall and Concurrently

Now that we have everything working, I'd like to show you a neat trick for running these two projects at the same time with one npm command!

We need to initialize an npm project in our root directory, currently the root of the Git project, but the server and client both have their own independent node projects. This is fine, it will stay that way, but we are going to make the root of the project it's own npm project as well.

Change directories to the root and run:

```bash
npm init -y && npm install concurrently --save-dev
```

This will initialize npm and accept all defaults (otherwise remove the `-y` flag) and install the package we need to concurrently run both projects with one command.

Let's setup the scripts individually and one script to run them together using `start`, we also will use `postinstall` to run each roject's install scripts independently when the root's install is run. `postinstall` is part of [npm scripts](https://docs.npmjs.com/misc/scripts) by default. Replace the current lines in your `package.json` with: 

```JSON
"name": "rage-with-couchbase",
"version": "0.1.0",
"description": "Concurrently run GraphQL Express Server and React application from the rage-with-couchbase project",
"scripts": {
 "client": "cd react-apollo-client && npm start",
 "server": "cd couchbase-gql-server && node server",
 "start": "concurrently --kill-others \"npm run server\" \"npm run client\"",
 "postinstall": "(cd couchbase-gql-server && npm install); (cd react-apollo-client && npm install);"
},
```

We have updated the name and description of our overall root project, set up two scripts for `client` and `server` that we can run concurrently with `npm start` on the root. Also, when someone clone's our repository, they can now run: `npm install && npm start` and it will install all packages from the three projects and afterward spin them up, so long as they have Couchbase Server running, it will all just work.

## Remove Username and Password From Server

One final nice touch would be to move our username and password for Couchbase Server out to its own `.env` file so that we are not shipping our username and password to GitHub for the world to see.

Change directories to `couchbase-gql-server/` and install `dotenv`:

```bash
npm install dotenv --save-dev
```

Next, import `dotenv` and destructure the variables we will have set up in our `.env` file

```JavaScript
require('dotenv').config()
const { CBSU, CBSP } = process.env
```

Update the code where we use the username and password: